<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Kaushlaya's Tracker</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{min-height:100vh;background:#0f172a;color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
button{cursor:pointer;border:none;outline:none;font-family:inherit}
input{outline:none;border:none;font-family:inherit}
.hidden{display:none!important}
/* Layout */
#header{background:#1e293b;border-bottom:1px solid #334155;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:10}
#reminder{background:rgba(245,158,11,.1);border-bottom:1px solid rgba(245,158,11,.3);padding:8px 16px;font-size:13px;color:#f59e0b}
#main{max-width:480px;margin:0 auto;padding:16px 12px;padding-bottom:40px}
/* Tabs */
.tab-btn{padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;background:#1e293b;color:#94a3b8;transition:all .2s}
.tab-btn.active{background:#22c55e;color:#fff}
/* Cards */
.card{background:#1e293b;border-radius:12px;padding:14px;margin-bottom:10px}
/* Section label */
.slabel{font-size:11px;color:#64748b;margin:12px 0 6px;letter-spacing:1px;text-transform:uppercase;font-weight:600}
/* Task row */
.trow{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;border:1px solid #334155;background:#1e293b;margin-bottom:6px;user-select:none;transition:border-color .2s,background .2s}
.trow:hover{border-color:#475569}
.trow.done-d{background:rgba(34,197,94,.12);border-color:#22c55e!important}
.trow.done-w{background:rgba(59,130,246,.12);border-color:#3b82f6!important}
.trow .icon{font-size:18px;flex-shrink:0}
.trow .lbl{flex:1;font-size:13px;font-weight:500;color:#e2e8f0;transition:all .2s}
.trow.done-d .lbl,.trow.done-w .lbl{color:#64748b;text-decoration:line-through}
.trow .drag{color:#475569;cursor:grab;font-size:14px;flex-shrink:0}
.trow .rm{color:#ef4444;font-size:11px;padding:2px 6px;border-radius:4px;background:rgba(239,68,68,.1);flex-shrink:0}
.chk{width:20px;height:20px;border-radius:50%;border:2px solid #475569;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:10px;transition:all .2s}
.chk.cd{background:#22c55e;border-color:#22c55e;color:#fff}
.chk.cw{background:#3b82f6;border-color:#3b82f6;color:#fff}
/* Progress */
.pbar{background:#334155;border-radius:99px;height:8px;overflow:hidden;margin-top:6px}
.pfill{height:8px;border-radius:99px;background:#22c55e;transition:width .4s}
/* Add button */
.add-btn{width:100%;padding:9px;border-radius:10px;border:1px dashed #334155;background:transparent;color:#64748b;font-size:13px;margin-bottom:8px;transition:all .2s}
.add-btn:hover{border-color:#475569;color:#94a3b8}
/* Add form */
.add-form{background:#0f172a;border-radius:10px;padding:12px;margin-bottom:8px;border:1px solid #334155}
.icon-grid{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px}
.ic-opt{font-size:18px;cursor:pointer;padding:4px;border-radius:6px;border:1px solid transparent;transition:all .15s}
.ic-opt.sel{background:rgba(34,197,94,.2);border-color:#22c55e}
.form-row{display:flex;gap:8px}
.form-row input{flex:1;background:#1e293b;color:#fff;padding:8px 12px;border-radius:8px;font-size:13px;border:1px solid #334155}
.form-row .btn-add{background:#22c55e;color:#fff;padding:8px 14px;border-radius:8px;font-size:13px;font-weight:600}
.form-row .btn-cancel{background:#334155;color:#94a3b8;padding:8px 10px;border-radius:8px;font-size:13px}
/* Perfect banner */
#perfect-banner{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);border-radius:12px;padding:14px;text-align:center;margin-bottom:10px}
/* Calendar */
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px}
.cal-head{text-align:center;font-size:11px;color:#64748b;padding:4px 0}
.cal-day{border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;border:2px solid transparent;aspect-ratio:1/1;transition:transform .15s}
.cal-day:hover:not(.future){transform:scale(1.1)}
.cal-day.today{border-color:#fff!important}
.cal-day.perfect{background:#22c55e}
.cal-day.partial{background:#f59e0b}
.cal-day.missed{background:#1e293b}
.cal-day.future{background:#1e293b;opacity:.3;cursor:default}
.cal-day span{font-size:11px;font-weight:700}
.cal-day small{font-size:8px}
.week-badge{text-align:right;font-size:10px;margin-bottom:4px;color:#475569}
.week-badge.pw{color:#22c55e;font-weight:700}
.legend{display:flex;gap:12px;margin-top:8px;font-size:11px;color:#64748b}
.leg-dot{display:inline-block;width:10px;height:10px;border-radius:3px;margin-right:4px;vertical-align:middle}
/* Nav */
.nav-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.nav-btn{background:#1e293b;color:#fff;padding:6px 12px;border-radius:8px;font-size:13px}
.nav-title{text-align:center}
.nav-title p{font-weight:700}
.nav-title small{font-size:11px;color:#94a3b8}
.nav-title small.good{color:#22c55e}
/* Stats */
.stat-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.stat-card{background:#1e293b;border-radius:12px;padding:12px;text-align:center}
.stat-card .se{font-size:22px}
.stat-card .sv{font-size:18px;font-weight:700}
.stat-card .sl{font-size:10px;color:#64748b}
/* Modal */
#modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);display:flex;align-items:flex-end;justify-content:center;z-index:50}
#modal-box{background:#1e293b;border-radius:16px 16px 0 0;width:100%;max-width:480px;padding:20px;max-height:80vh;overflow-y:auto}
#modal-box .mhdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
#modal-box .close-btn{background:#334155;color:#94a3b8;border-radius:8px;padding:4px 10px;font-size:16px}
/* Scrollbar */
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-track{background:#1e293b}
::-webkit-scrollbar-thumb{background:#475569;border-radius:2px}
</style>
</head>
<body>

<div id="header">
  <div>
    <div style="font-size:16px;font-weight:700">ğŸ¯ Kaushlaya's Tracker</div>
    <div id="today-date" style="font-size:11px;color:#64748b"></div>
  </div>
  <div style="display:flex;gap:4px">
    <button class="tab-btn active" onclick="setView('today')">ğŸ“‹ Today</button>
    <button class="tab-btn" onclick="setView('calendar')">ğŸ“… Cal</button>
    <button class="tab-btn" onclick="setView('stats')">ğŸ“Š Stats</button>
  </div>
</div>

<div id="reminder" class="hidden"></div>
<div id="main"></div>
<div id="modal-overlay" class="hidden" onclick="closeModal()">
  <div id="modal-box" onclick="event.stopPropagation()"></div>
</div>

<script>
// â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var DEFAULT_DAILY=[
  {id:"study",label:"8hrs Self Study",icon:"ğŸ“š",fixed:true},
  {id:"questions",label:"4hrs Question Practice",icon:"âœï¸",fixed:true},
  {id:"exercise",label:"Exercise",icon:"ğŸ’ª",fixed:true},
  {id:"water",label:"3 Litres of Water",icon:"ğŸ’§",fixed:true},
  {id:"nojunk",label:"Avoided Junk Food",icon:"ğŸ¥—",fixed:true}
];
var DEFAULT_WEEKLY=[
  {id:"room",label:"Room Organize",icon:"ğŸ ",fixed:true},
  {id:"sketch",label:"Sketching",icon:"ğŸ¨",fixed:true}
];
var ICONS=["ğŸ“š","âœï¸","ğŸ’ª","ğŸ’§","ğŸ¥—","ğŸ ","ğŸ¨","ğŸ§˜","ğŸƒ","ğŸ“–","ğŸµ","ğŸ","ğŸ’¤","ğŸ§¹","ğŸŒ¿","ğŸ¯","ğŸ’»","ğŸ“","ğŸ›","â˜€ï¸"];
var COLORS=["#22c55e","#3b82f6","#f59e0b","#06b6d4","#a78bfa","#f97316","#ec4899"];

var appData={}, dailyTasks=[], weeklyTasks=[], currentView="today";
var calYear=new Date().getFullYear(), calMonth=new Date().getMonth();
var selectedDay=null, addingFor=null, newIcon="ğŸ“", dragIdx=null, dragType=null;

function loadData(){
  try{
    var d=localStorage.getItem("kt_data"); appData=d?JSON.parse(d):{};
    var dt=localStorage.getItem("kt_daily"); dailyTasks=dt?JSON.parse(dt):JSON.parse(JSON.stringify(DEFAULT_DAILY));
    var wt=localStorage.getItem("kt_weekly"); weeklyTasks=wt?JSON.parse(wt):JSON.parse(JSON.stringify(DEFAULT_WEEKLY));
  }catch(e){
    appData={}; dailyTasks=JSON.parse(JSON.stringify(DEFAULT_DAILY)); weeklyTasks=JSON.parse(JSON.stringify(DEFAULT_WEEKLY));
  }
}
function saveData(){
  try{
    localStorage.setItem("kt_data",JSON.stringify(appData));
    localStorage.setItem("kt_daily",JSON.stringify(dailyTasks));
    localStorage.setItem("kt_weekly",JSON.stringify(weeklyTasks));
  }catch(e){}
}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function dKey(y,m,d){return y+"-"+pad(m+1)+"-"+pad(d)}
function pad(n){return String(n).padStart(2,"0")}
function todayKey(){var t=new Date();return dKey(t.getFullYear(),t.getMonth(),t.getDate())}
function isPerfect(dk){return dailyTasks.length>0&&dailyTasks.every(function(t){return appData[dk]&&appData[dk].daily&&appData[dk].daily[t.id]})}
function isPartial(dk){return dailyTasks.some(function(t){return appData[dk]&&appData[dk].daily&&appData[dk].daily[t.id]})}
function toggle(dk,type,id){
  if(!appData[dk])appData[dk]={daily:{},weekly:{}};
  if(!appData[dk][type])appData[dk][type]={};
  appData[dk][type][id]=!appData[dk][type][id];
  saveData(); render();
}
function getWeeks(y,m){
  var first=new Date(y,m,1).getDay(), days=new Date(y,m+1,0).getDate();
  var weeks=[],week=[];
  for(var i=0;i<first;i++)week.push(0);
  for(var d=1;d<=days;d++){week.push(d);if(week.length===7){weeks.push(week);week=[];}}
  if(week.length){while(week.length<7)week.push(0);weeks.push(week);}
  return weeks;
}
function monthLabel(y,m){return new Date(y,m).toLocaleString("default",{month:"long",year:"numeric"})}
function perfectInMonth(y,m){
  var days=new Date(y,m+1,0).getDate(),c=0;
  for(var d=1;d<=days;d++)if(isPerfect(dKey(y,m,d)))c++;
  return c;
}
function setView(v){
  currentView=v;
  document.querySelectorAll(".tab-btn").forEach(function(b,i){
    b.classList.toggle("active",["today","calendar","stats"][i]===v);
  });
  render();
}
function closeModal(){selectedDay=null;document.getElementById("modal-overlay").classList.add("hidden");render();}
function navCal(dir){
  var d=new Date(calYear,calMonth+dir);
  calYear=d.getFullYear();calMonth=d.getMonth();render();
}

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render(){
  document.getElementById("today-date").textContent=new Date().toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"});
  updateReminder();
  var main=document.getElementById("main");
  if(currentView==="today")main.innerHTML=buildToday();
  else if(currentView==="calendar")main.innerHTML=buildCalendar();
  else main.innerHTML=buildStats();
  bindEvents();
  if(currentView==="stats")drawChart();
}

function updateReminder(){
  var tk=todayKey(),done=dailyTasks.filter(function(t){return appData[tk]&&appData[tk].daily&&appData[tk].daily[t.id]}).length;
  var rem=dailyTasks.length-done, el=document.getElementById("reminder");
  if(rem>0&&currentView==="today"){el.textContent="â° "+rem+" task"+(rem!==1?"s":"")+" remaining today â€” keep going!";el.classList.remove("hidden");}
  else el.classList.add("hidden");
}

function buildToday(){
  var tk=todayKey();
  var done=dailyTasks.filter(function(t){return appData[tk]&&appData[tk].daily&&appData[tk].daily[t.id]}).length;
  var total=dailyTasks.length, pct=total?Math.round(done/total*100):0, perfect=done===total&&total>0;
  var h="";
  if(perfect)h+='<div id="perfect-banner"><div style="font-size:32px">ğŸ†</div><div style="color:#22c55e;font-weight:700;font-size:16px">Perfect Day, Kaushlaya!</div></div>';
  h+='<div class="card"><div style="display:flex;justify-content:space-between;font-size:13px;color:#94a3b8;margin-bottom:6px"><span>Daily Progress</span><span style="color:#fff;font-weight:700">'+done+"/"+total+" â€” "+pct+'%</span></div><div class="pbar"><div class="pfill" style="width:'+pct+'%"></div></div></div>';
  h+='<div class="slabel">Daily Tasks â€” drag to reorder</div>';
  dailyTasks.forEach(function(t,i){h+=taskRowHTML(t,!!(appData[tk]&&appData[tk].daily&&appData[tk].daily[t.id]),"daily",i,tk);});
  if(addingFor==="daily")h+=addFormHTML("daily");
  else h+='<button class="add-btn" onclick="openAdd(\'daily\')">+ Add Daily Task</button>';
  h+='<div class="slabel">Weekly Tasks (once a week)</div>';
  weeklyTasks.forEach(function(t,i){h+=taskRowHTML(t,!!(appData[tk]&&appData[tk].weekly&&appData[tk].weekly[t.id]),"weekly",i,tk);});
  if(addingFor==="weekly")h+=addFormHTML("weekly");
  else h+='<button class="add-btn" onclick="openAdd(\'weekly\')">+ Add Weekly Task</button>';
  return h;
}

function taskRowHTML(t,done,type,i,dk){
  var cls="trow"+(done?(type==="weekly"?" done-w":" done-d"):"");
  var chk='<div class="chk'+(done?(type==="weekly"?" cw":" cd"):"")+'">'+( done?"âœ“":"")+'</div>';
  var rm=!t.fixed?'<button class="rm" onclick="removeTask(\''+type+'\',\''+t.id+'\',event)">âœ•</button>':"";
  return '<div class="'+cls+'" onclick="toggle(\''+dk+'\',\''+type+'\',\''+t.id+'\')" draggable="true" data-idx="'+i+'" data-type="'+type+'"><span class="icon">'+t.icon+'</span><span class="lbl">'+t.label+'</span>'+rm+chk+'<span class="drag">â ¿</span></div>';
}

function addFormHTML(type){
  var icons=ICONS.map(function(ic){return'<span class="ic-opt'+(newIcon===ic?" sel":"")+'" onclick="setIcon(\''+ic+'\')">'+ic+'</span>';}).join("");
  return '<div class="add-form"><div class="icon-grid">'+icons+'</div><div class="form-row"><input id="new-task-input" type="text" placeholder="Task name..." onkeydown="if(event.key===\'Enter\')submitAdd(\''+type+'\')"/><button class="btn-add" onclick="submitAdd(\''+type+'\')">Add</button><button class="btn-cancel" onclick="cancelAdd()">âœ•</button></div></div>';
}

function buildCalendar(){
  var pd=perfectInMonth(calYear,calMonth), isPM=pd>=25;
  var h='<div class="nav-row"><button class="nav-btn" onclick="navCal(-1)">â—€</button><div class="nav-title"><p>'+monthLabel(calYear,calMonth)+'</p><small class="'+(isPM?"good":"")+'">'+( isPM?"ğŸ† Perfect Month!":pd+"/25 perfect days")+'</small></div><button class="nav-btn" onclick="navCal(1)">â–¶</button></div>';
  h+='<div class="cal-grid">'+["S","M","T","W","T","F","S"].map(function(d){return'<div class="cal-head">'+d+'</div>';}).join("")+'</div>';
  var tk=todayKey(),weeks=getWeeks(calYear,calMonth);
  weeks.forEach(function(week){
    h+='<div class="cal-grid" style="margin-bottom:2px">';
    var pDays=0;
    week.forEach(function(day){
      if(!day){h+='<div></div>';return;}
      var dk=dKey(calYear,calMonth,day);
      var isToday=dk===tk, isFuture=new Date(calYear,calMonth,day)>new Date();
      var perf=isPerfect(dk),part=!perf&&isPartial(dk);
      var cls="cal-day"+(isToday?" today":"")+(isFuture?" future":perf?" perfect":part?" partial":" missed");
      if(perf)pDays++;
      var onclick=!isFuture?'onclick="openDay(\''+dk+'\')"':"";
      h+='<div class="'+cls+'" '+onclick+'><span>'+day+'</span>'+(perf?'<small>â­</small>':"")+'</div>';
    });
    h+='</div>';
    var wDone=weeklyTasks.every(function(t){return week.some(function(d){return d&&appData[dKey(calYear,calMonth,d)]&&appData[dKey(calYear,calMonth,d)].weekly&&appData[dKey(calYear,calMonth,d)].weekly[t.id]});});
    var isPW=pDays>=6&&wDone;
    if(pDays>0||isPW)h+='<div class="week-badge'+(isPW?" pw":"")+'">'+( isPW?"ğŸ… Perfect Week! ("+pDays+" days)":pDays+"/6 perfect days")+'</div>';
  });
  h+='<div class="legend"><span><span class="leg-dot" style="background:#22c55e"></span>Perfect</span><span><span class="leg-dot" style="background:#f59e0b"></span>Partial</span><span><span class="leg-dot" style="background:#1e293b;border:1px solid #334155"></span>Missed</span></div>';
  return h;
}

function buildStats(){
  var pd=perfectInMonth(calYear,calMonth), isPM=pd>=25, total=new Date(calYear,calMonth+1,0).getDate();
  var h='<div class="nav-row"><button class="nav-btn" onclick="navCal(-1)">â—€</button><div class="nav-title"><p>'+monthLabel(calYear,calMonth)+'</p></div><button class="nav-btn" onclick="navCal(1)">â–¶</button></div>';
  h+='<div class="stat-cards">';
  [{e:"â­",v:pd,l:"Perfect Days",c:"#22c55e"},{e:"ğŸ†",v:isPM?"YES!":pd+"/25",l:"Perfect Month",c:isPM?"#22c55e":"#f59e0b"},{e:"ğŸ“ˆ",v:Math.round(pd/total*100)+"%",l:"Completion",c:"#3b82f6"}].forEach(function(s){
    h+='<div class="stat-card"><div class="se">'+s.e+'</div><div class="sv" style="color:'+s.c+'">'+s.v+'</div><div class="sl">'+s.l+'</div></div>';
  });
  h+='</div>';
  h+='<div class="card"><div style="font-size:13px;font-weight:600;color:#94a3b8;margin-bottom:10px">Task Completion</div><canvas id="chart" width="440" height="180" style="width:100%;max-height:180px"></canvas></div>';
  h+='<div class="card"><div style="font-size:13px;font-weight:600;color:#94a3b8;margin-bottom:10px">Weekly Tasks</div>';
  var weeks=getWeeks(calYear,calMonth);
  weeklyTasks.forEach(function(task){
    var done=weeks.filter(function(w){return w.some(function(d){return d&&appData[dKey(calYear,calMonth,d)]&&appData[dKey(calYear,calMonth,d)].weekly&&appData[dKey(calYear,calMonth,d)].weekly[task.id]});}).length;
    h+='<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><span>'+task.icon+'</span><span style="flex:1;font-size:13px">'+task.label+'</span><span style="color:#22c55e;font-weight:700;font-size:13px">'+done+"/"+weeks.length+" weeks</span></div>";
  });
  h+='</div>';
  return h;
}

function drawChart(){
  var canvas=document.getElementById("chart"); if(!canvas)return;
  var ctx=canvas.getContext("2d");
  var total=new Date(calYear,calMonth+1,0).getDate();
  var taskData=dailyTasks.map(function(t){
    var c=0;for(var d=1;d<=total;d++)if(appData[dKey(calYear,calMonth,d)]&&appData[dKey(calYear,calMonth,d)].daily&&appData[dKey(calYear,calMonth,d)].daily[t.id])c++;
    return{label:t.icon+" "+t.label.split(" ").slice(0,2).join(" "),count:c};
  });
  var maxVal=Math.max.apply(null,taskData.map(function(d){return d.count}));if(!maxVal)maxVal=1;
  var W=canvas.width,H=canvas.height,padL=30,bottom=50,n=taskData.length,slot=(W-padL-10)/n,bw=slot-8;
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle="#334155";ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(padL,8);ctx.lineTo(padL,H-bottom);ctx.stroke();
  ctx.beginPath();ctx.moveTo(padL,H-bottom);ctx.lineTo(W-8,H-bottom);ctx.stroke();
  taskData.forEach(function(d,i){
    var x=padL+i*slot+4, bh=Math.max(((d.count/maxVal)*(H-bottom-16)),2), by=H-bottom-bh;
    ctx.fillStyle=COLORS[i%COLORS.length];
    ctx.beginPath();if(ctx.roundRect)ctx.roundRect(x,by,bw,bh,3);else ctx.rect(x,by,bw,bh);ctx.fill();
    ctx.fillStyle="#e2e8f0";ctx.font="bold 11px sans-serif";ctx.textAlign="center";
    if(d.count>0)ctx.fillText(d.count,x+bw/2,by-3);
    ctx.fillStyle="#64748b";ctx.font="9px sans-serif";
    ctx.save();ctx.translate(x+bw/2,H-bottom+5);ctx.rotate(-0.55);ctx.textAlign="right";
    ctx.fillText(d.label,0,0);ctx.restore();
  });
}

function buildModalContent(dk){
  var sd=appData[dk]||{daily:{},weekly:{}};
  var dateStr=new Date(dk+"T12:00:00").toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"});
  var perf=isPerfect(dk);
  var h='<div class="mhdr"><div><div style="font-weight:700">'+dateStr+'</div>'+(perf?'<div style="color:#22c55e;font-size:12px;font-weight:600">â­ Perfect Day!</div>':"")+'</div><button class="close-btn" onclick="closeModal()">âœ•</button></div>';
  dailyTasks.forEach(function(t){
    var done=!!(sd.daily&&sd.daily[t.id]);
    h+='<div class="trow'+(done?" done-d":"")+ '" onclick="toggle(\''+dk+'\',\'daily\',\''+t.id+'\')" style="margin-bottom:6px"><span class="icon">'+t.icon+'</span><span class="lbl">'+t.label+'</span><div class="chk'+(done?" cd":"")+'">'+( done?"âœ“":"")+'</div></div>';
  });
  weeklyTasks.forEach(function(t){
    var done=!!(sd.weekly&&sd.weekly[t.id]);
    h+='<div class="trow'+(done?" done-w":"")+ '" onclick="toggle(\''+dk+'\',\'weekly\',\''+t.id+'\')" style="margin-bottom:6px"><span class="icon">'+t.icon+'</span><span class="lbl">'+t.label+' (weekly)</span><div class="chk'+(done?" cw":"")+'">'+( done?"âœ“":"")+'</div></div>';
  });
  return h;
}

// â”€â”€ Event binders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function bindEvents(){
  document.querySelectorAll(".trow[draggable]").forEach(function(row){
    row.addEventListener("dragstart",function(){dragIdx=parseInt(row.dataset.idx);dragType=row.dataset.type;});
    row.addEventListener("dragover",function(e){
      e.preventDefault();
      var ti=parseInt(row.dataset.idx),tt=row.dataset.type;
      if(dragIdx===null||dragIdx===ti||dragType!==tt)return;
      var arr=tt==="daily"?dailyTasks:weeklyTasks;
      var moved=arr.splice(dragIdx,1)[0];arr.splice(ti,0,moved);
      dragIdx=ti;saveData();render();
    });
    row.addEventListener("dragend",function(){dragIdx=null;dragType=null;});
  });
}

// â”€â”€ Global functions (called from HTML) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.setView=setView;
window.openAdd=function(type){addingFor=type;render();setTimeout(function(){var i=document.getElementById("new-task-input");if(i)i.focus();},50);};
window.cancelAdd=function(){addingFor=null;render();};
window.setIcon=function(ic){newIcon=ic;render();setTimeout(function(){var i=document.getElementById("new-task-input");if(i)i.focus();},50);};
window.submitAdd=function(type){
  var inp=document.getElementById("new-task-input");
  var label=inp?inp.value.trim():"";
  if(!label)return;
  var task={id:"c"+Date.now(),label:label,icon:newIcon,fixed:false};
  if(type==="daily")dailyTasks.push(task);else weeklyTasks.push(task);
  addingFor=null;newIcon="ğŸ“";saveData();render();
};
window.removeTask=function(type,id,e){
  if(e)e.stopPropagation();
  if(type==="daily")dailyTasks=dailyTasks.filter(function(t){return t.id!==id;});
  else weeklyTasks=weeklyTasks.filter(function(t){return t.id!==id;});
  saveData();render();
};
window.openDay=function(dk){
  selectedDay=dk;
  var overlay=document.getElementById("modal-overlay"),box=document.getElementById("modal-box");
  box.innerHTML=buildModalContent(dk);
  overlay.classList.remove("hidden");
};
window.navCal=navCal;
window.closeModal=closeModal;
window.toggle=toggle;

// â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadData();
render();
</script>
</body>
</html>

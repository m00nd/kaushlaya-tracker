<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Kaushlaya's Tracker</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#0f172a;color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;min-height:100vh}
button{cursor:pointer;border:none;outline:none;transition:all .2s}
input{outline:none;border:none;font-family:inherit}
.task-row{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;border:1px solid #334155;background:#1e293b;margin-bottom:6px;user-select:none;transition:all .2s}
.task-row:hover{border-color:#475569}
.task-row.done-daily{background:rgba(34,197,94,.12);border-color:#22c55e}
.task-row.done-weekly{background:rgba(59,130,246,.12);border-color:#3b82f6}
.card{background:#1e293b;border-radius:12px;padding:14px;margin-bottom:10px}
.tab-btn{padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;cursor:pointer;border:none;transition:all .2s;color:#94a3b8;background:#1e293b}
.tab-btn.active{background:#22c55e;color:#fff}
.section-label{font-size:11px;color:#64748b;margin-bottom:6px;letter-spacing:1px;text-transform:uppercase;font-weight:600;margin-top:8px}
.add-btn{width:100%;padding:9px;border-radius:10px;border:1px dashed #334155;background:transparent;color:#64748b;font-size:13px;cursor:pointer;margin-bottom:8px;transition:all .2s}
.add-btn:hover{border-color:#475569;color:#94a3b8}
.nav-btn{background:#1e293b;color:#fff;padding:6px 12px;border-radius:8px;font-size:13px}
.check-circle{width:20px;height:20px;border-radius:50%;border:2px solid #475569;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:11px;color:#fff}
.check-circle.checked-daily{background:#22c55e;border-color:#22c55e}
.check-circle.checked-weekly{background:#3b82f6;border-color:#3b82f6}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);display:flex;align-items:flex-end;justify-content:center;z-index:50}
.modal-box{background:#1e293b;border-radius:16px 16px 0 0;width:100%;max-width:480px;padding:20px;max-height:80vh;overflow-y:auto}
.cal-day{border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;border:2px solid transparent;transition:transform .15s;aspect-ratio:1/1}
.cal-day:hover{transform:scale(1.1)}
.cal-day.today{border-color:#fff}
.cal-day.perfect{background:#22c55e}
.cal-day.partial{background:#f59e0b}
.cal-day.missed{background:#1e293b}
.cal-day.future{background:#1e293b;opacity:.3;cursor:default}
.stat-card{background:#1e293b;border-radius:12px;padding:12px;text-align:center}
.progress-bar{background:#334155;border-radius:99px;height:8px;overflow:hidden}
.progress-fill{height:8px;border-radius:99px;background:#22c55e;transition:width .4s}
.icon-picker{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px}
.icon-opt{font-size:18px;cursor:pointer;padding:4px;border-radius:6px;border:1px solid transparent;transition:all .15s}
.icon-opt.selected{background:rgba(34,197,94,.2);border-color:#22c55e}
.remove-btn{color:#ef4444;font-size:11px;cursor:pointer;padding:2px 6px;border-radius:4px;background:rgba(239,68,68,.1);border:none}
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-track{background:#1e293b}
::-webkit-scrollbar-thumb{background:#475569;border-radius:2px}
</style>
</head>
<body>
<div id="app"></div>

<script>
const DEFAULT_DAILY=[
  {id:"study",label:"8hrs Self Study",icon:"ğŸ“š",fixed:true},
  {id:"questions",label:"4hrs Question Practice",icon:"âœï¸",fixed:true},
  {id:"exercise",label:"Exercise",icon:"ğŸ’ª",fixed:true},
  {id:"water",label:"3 Litres of Water",icon:"ğŸ’§",fixed:true},
  {id:"nojunk",label:"Avoided Junk Food",icon:"ğŸ¥—",fixed:true},
];
const DEFAULT_WEEKLY=[
  {id:"room",label:"Room Organize",icon:"ğŸ ",fixed:true},
  {id:"sketch",label:"Sketching",icon:"ğŸ¨",fixed:true},
];
const ICONS=["ğŸ“š","âœï¸","ğŸ’ª","ğŸ’§","ğŸ¥—","ğŸ ","ğŸ¨","ğŸ§˜","ğŸƒ","ğŸ“–","ğŸµ","ğŸ","ğŸ’¤","ğŸ§¹","ğŸŒ¿","ğŸ¯","ğŸ’»","ğŸ“","ğŸ›","â˜€ï¸"];
const COLORS=["#22c55e","#3b82f6","#f59e0b","#06b6d4","#a78bfa","#f97316","#ec4899"];

// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function dKey(y,m,d){return `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`}
function todayKey(){const t=new Date();return dKey(t.getFullYear(),t.getMonth(),t.getDate())}
function getWeeks(y,m){
  const first=new Date(y,m,1).getDay(),days=new Date(y,m+1,0).getDate();
  const weeks=[];let week=Array(first).fill(null);
  for(let d=1;d<=days;d++){week.push(d);if(week.length===7){weeks.push(week);week=[];}}
  if(week.length){while(week.length<7)week.push(null);weeks.push(week);}
  return weeks;
}
function monthName(y,m){return new Date(y,m).toLocaleString("default",{month:"long",year:"numeric"})}
function todayDisplay(){return new Date().toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"})}
function el(tag,props,...children){
  const e=document.createElement(tag);
  if(props)Object.entries(props).forEach(([k,v])=>{
    if(k==="className")e.className=v;
    else if(k==="style"&&typeof v==="object")Object.assign(e.style,v);
    else if(k.startsWith("on"))e.addEventListener(k.slice(2).toLowerCase(),v);
    else e.setAttribute(k,v);
  });
  children.flat().forEach(c=>{if(c==null)return;e.appendChild(typeof c==="string"?document.createTextNode(c):c)});
  return e;
}

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let state={
  data:{},
  dailyTasks:[...DEFAULT_DAILY],
  weeklyTasks:[...DEFAULT_WEEKLY],
  view:"today",
  cal:{y:new Date().getFullYear(),m:new Date().getMonth()},
  selDay:null,
  addingFor:null,
  newLabel:"",
  newIcon:"ğŸ“",
  dragIdx:null,
  dragType:null,
};

function load(){
  try{
    const d=localStorage.getItem("ktracker-data");if(d)state.data=JSON.parse(d);
    const dt=localStorage.getItem("ktracker-daily");if(dt)state.dailyTasks=JSON.parse(dt);
    const wt=localStorage.getItem("ktracker-weekly");if(wt)state.weeklyTasks=JSON.parse(wt);
  }catch{}
}
function save(){
  try{
    localStorage.setItem("ktracker-data",JSON.stringify(state.data));
    localStorage.setItem("ktracker-daily",JSON.stringify(state.dailyTasks));
    localStorage.setItem("ktracker-weekly",JSON.stringify(state.weeklyTasks));
  }catch{}
}
function setState(patch){Object.assign(state,typeof patch==="function"?patch(state):patch);save();render();}

// â”€â”€â”€ Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggle(dk,type,id){
  const data={...state.data};
  const day=data[dk]||{daily:{},weekly:{}};
  const sec={...(day[type]||{})};
  sec[id]=!sec[id];
  data[dk]={...day,[type]:sec};
  setState({data});
}
function isPerfect(dk){return state.dailyTasks.length>0&&state.dailyTasks.every(t=>state.data[dk]?.daily?.[t.id]);}
function isPartial(dk){return state.dailyTasks.some(t=>state.data[dk]?.daily?.[t.id]);}
function perfectInMonth(y,m){
  const days=new Date(y,m+1,0).getDate();
  let c=0;for(let d=1;d<=days;d++)if(isPerfect(dKey(y,m,d)))c++;
  return c;
}
function addTask(type){
  if(!state.newLabel.trim())return;
  const task={id:"c"+Date.now(),label:state.newLabel.trim(),icon:state.newIcon,fixed:false};
  if(type==="daily")setState({dailyTasks:[...state.dailyTasks,task],addingFor:null,newLabel:"",newIcon:"ğŸ“"});
  else setState({weeklyTasks:[...state.weeklyTasks,task],addingFor:null,newLabel:"",newIcon:"ğŸ“"});
}
function removeTask(type,id){
  if(type==="daily")setState({dailyTasks:state.dailyTasks.filter(t=>t.id!==id)});
  else setState({weeklyTasks:state.weeklyTasks.filter(t=>t.id!==id)});
}

// â”€â”€â”€ Build UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildHeader(){
  const tk=todayKey();
  return el("div",{style:{background:"#1e293b",borderBottom:"1px solid #334155",padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:10}},
    el("div",null,
      el("div",{style:{fontSize:16,fontWeight:700}},"ğŸ¯ Kaushlaya's Tracker"),
      el("div",{style:{fontSize:11,color:"#64748b"}},todayDisplay())
    ),
    el("div",{style:{display:"flex",gap:4}},
      ...["today","calendar","stats"].map(v=>
        el("button",{className:"tab-btn"+(state.view===v?" active":""),onClick:()=>setState({view:v})},
          v==="today"?"ğŸ“‹ Today":v==="calendar"?"ğŸ“… Cal":"ğŸ“Š Stats"
        )
      )
    )
  );
}

function buildReminder(){
  const tk=todayKey();
  const done=state.dailyTasks.filter(t=>state.data[tk]?.daily?.[t.id]).length;
  const rem=state.dailyTasks.length-done;
  if(rem===0||state.view!=="today")return null;
  return el("div",{style:{background:"rgba(245,158,11,.1)",borderBottom:"1px solid rgba(245,158,11,.3)",padding:"8px 16px",fontSize:13,color:"#f59e0b"}},
    `â° ${rem} task${rem!==1?"s":""} remaining today â€” keep going!`
  );
}

function buildTaskRow(task,done,type,idx,onToggle){
  const row=el("div",{className:"task-row"+(done?(type==="weekly"?" done-weekly":" done-daily"):""),onClick:onToggle,draggable:true});
  row.addEventListener("dragstart",()=>setState({dragIdx:idx,dragType:type}));
  row.addEventListener("dragover",e=>{
    e.preventDefault();
    if(state.dragIdx===null||state.dragIdx===idx||state.dragType!==type)return;
    const arr=type==="daily"?[...state.dailyTasks]:[...state.weeklyTasks];
    const [moved]=arr.splice(state.dragIdx,1);
    arr.splice(idx,0,moved);
    if(type==="daily")setState({dailyTasks:arr,dragIdx:idx});
    else setState({weeklyTasks:arr,dragIdx:idx});
  });
  row.addEventListener("dragend",()=>setState({dragIdx:null,dragType:null}));
  row.appendChild(el("span",{style:{fontSize:18}},task.icon));
  row.appendChild(el("span",{style:{flex:1,fontSize:13,fontWeight:500,color:done?"#64748b":"#e2e8f0",textDecoration:done?"line-through":"none"}},task.label));
  if(!task.fixed){
    const rb=el("button",{className:"remove-btn",onClick:e=>{e.stopPropagation();removeTask(type,task.id)}},"âœ•");
    row.appendChild(rb);
  }
  const cc=el("div",{className:"check-circle"+(done?(type==="weekly"?" checked-weekly":" checked-daily"):"")},done?"âœ“":"");
  row.appendChild(cc);
  row.appendChild(el("span",{style:{color:"#475569",cursor:"grab",fontSize:14}},"â ¿"));
  return row;
}

function buildAddForm(type){
  const wrap=el("div",{style:{background:"#0f172a",borderRadius:10,padding:12,marginBottom:8,border:"1px solid #334155"}});
  const iconPicker=el("div",{className:"icon-picker"});
  ICONS.forEach(ic=>{
    const s=el("span",{className:"icon-opt"+(state.newIcon===ic?" selected":""),onClick:()=>setState({newIcon:ic})},ic);
    iconPicker.appendChild(s);
  });
  wrap.appendChild(iconPicker);
  const row=el("div",{style:{display:"flex",gap:8}});
  const inp=el("input",{style:{flex:1,background:"#1e293b",color:"#fff",padding:"8px 12px",borderRadius:8,fontSize:13,border:"1px solid #334155"},placeholder:"Task name..."});
  inp.value=state.newLabel;
  inp.addEventListener("input",e=>state.newLabel=e.target.value);
  inp.addEventListener("keydown",e=>{if(e.key==="Enter")addTask(type);});
  const addB=el("button",{style:{background:"#22c55e",color:"#fff",padding:"8px 14px",borderRadius:8,fontSize:13,fontWeight:600},onClick:()=>addTask(type)},"Add");
  const canB=el("button",{style:{background:"#334155",color:"#94a3b8",padding:"8px 10px",borderRadius:8,fontSize:13},onClick:()=>setState({addingFor:null,newLabel:"",newIcon:"ğŸ“"})},"âœ•");
  row.append(inp,addB,canB);
  wrap.appendChild(row);
  return wrap;
}

function buildToday(){
  const tk=todayKey();
  const todayData=state.data[tk]||{daily:{},weekly:{}};
  const done=state.dailyTasks.filter(t=>todayData.daily?.[t.id]).length;
  const total=state.dailyTasks.length;
  const pct=total?Math.round((done/total)*100):0;
  const perfect=done===total&&total>0;
  const wrap=el("div",null);

  if(perfect){
    wrap.appendChild(el("div",{className:"card",style:{textAlign:"center",background:"rgba(34,197,94,.1)",border:"1px solid rgba(34,197,94,.3)"}},
      el("div",{style:{fontSize:32}},"ğŸ†"),
      el("div",{style:{color:"#22c55e",fontWeight:700,fontSize:16}},"Perfect Day, Kaushlaya!")
    ));
  }

  // Progress
  const prog=el("div",{className:"card"});
  prog.appendChild(el("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6,fontSize:13,color:"#94a3b8"}},
    el("span",null,"Daily Progress"),
    el("span",{style:{color:"#fff",fontWeight:700}},`${done}/${total} â€” ${pct}%`)
  ));
  const bar=el("div",{className:"progress-bar"});
  bar.appendChild(el("div",{className:"progress-fill",style:{width:pct+"%"}}));
  prog.appendChild(bar);
  wrap.appendChild(prog);

  // Daily
  wrap.appendChild(el("div",{className:"section-label"},"Daily Tasks â€” drag to reorder"));
  state.dailyTasks.forEach((task,i)=>{
    const done=!!todayData.daily?.[task.id];
    wrap.appendChild(buildTaskRow(task,done,"daily",i,()=>toggle(tk,"daily",task.id)));
  });
  if(state.addingFor==="daily") wrap.appendChild(buildAddForm("daily"));
  else wrap.appendChild(el("button",{className:"add-btn",onClick:()=>setState({addingFor:"daily"})},"+ Add Daily Task"));

  // Weekly
  wrap.appendChild(el("div",{className:"section-label"},"Weekly Tasks (once a week)"));
  state.weeklyTasks.forEach((task,i)=>{
    const done=!!todayData.weekly?.[task.id];
    wrap.appendChild(buildTaskRow(task,done,"weekly",i,()=>toggle(tk,"weekly",task.id)));
  });
  if(state.addingFor==="weekly") wrap.appendChild(buildAddForm("weekly"));
  else wrap.appendChild(el("button",{className:"add-btn",onClick:()=>setState({addingFor:"weekly"})},"+ Add Weekly Task"));

  return wrap;
}

function buildCalendar(){
  const {y,m}=state.cal;
  const tk=todayKey();
  const pd=perfectInMonth(y,m);
  const isPM=pd>=25;
  const wrap=el("div",null);

  // Nav
  const nav=el("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12}});
  nav.appendChild(el("button",{className:"nav-btn",onClick:()=>{const d=new Date(y,m-1);setState({cal:{y:d.getFullYear(),m:d.getMonth()}})}},"â—€"));
  nav.appendChild(el("div",{style:{textAlign:"center"}},
    el("div",{style:{fontWeight:700}},monthName(y,m)),
    el("div",{style:{fontSize:11,color:isPM?"#22c55e":"#94a3b8"}},isPM?"ğŸ† Perfect Month!":pd+"/25 perfect days")
  ));
  nav.appendChild(el("button",{className:"nav-btn",onClick:()=>{const d=new Date(y,m+1);setState({cal:{y:d.getFullYear(),m:d.getMonth()}})}},"â–¶"));
  wrap.appendChild(nav);

  // Day headers
  const hdr=el("div",{style:{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,marginBottom:4}});
  ["S","M","T","W","T","F","S"].forEach(d=>hdr.appendChild(el("div",{style:{textAlign:"center",fontSize:11,color:"#64748b",padding:"4px 0"}},d)));
  wrap.appendChild(hdr);

  getWeeks(y,m).forEach(week=>{
    const pDays=week.filter(d=>d&&isPerfect(dKey(y,m,d))).length;
    const wDone=state.weeklyTasks.every(t=>week.some(d=>d&&state.data[dKey(y,m,d)]?.weekly?.[t.id]));
    const isPW=pDays>=6&&wDone;

    const grid=el("div",{style:{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,marginBottom:2}});
    week.forEach(day=>{
      if(!day){grid.appendChild(el("div",null));return;}
      const dk=dKey(y,m,day);
      const isToday=dk===tk;
      const isFuture=new Date(y,m,day)>new Date();
      const perf=isPerfect(dk),part=!perf&&isPartial(dk);
      let cls="cal-day";
      if(isToday)cls+=" today";
      if(isFuture)cls+=" future";
      else if(perf)cls+=" perfect";
      else if(part)cls+=" partial";
      else cls+=" missed";
      const cell=el("div",{className:cls},
        el("span",{style:{fontSize:11,fontWeight:700}},String(day)),
        perf?el("span",{style:{fontSize:8}},"â­"):null
      );
      if(!isFuture)cell.addEventListener("click",()=>setState({selDay:dk}));
      grid.appendChild(cell);
    });
    wrap.appendChild(grid);
    if(pDays>0||isPW){
      wrap.appendChild(el("div",{style:{textAlign:"right",fontSize:10,marginBottom:4,color:isPW?"#22c55e":"#475569",fontWeight:isPW?"700":"400"}},
        isPW?`ğŸ… Perfect Week! (${pDays} days)`:`${pDays}/6 perfect days`
      ));
    }
  });

  // Legend
  const leg=el("div",{style:{display:"flex",gap:12,marginTop:8,fontSize:11,color:"#64748b"}});
  [["#22c55e","Perfect"],["#f59e0b","Partial"],["#1e293b","Missed"]].forEach(([bg,label])=>{
    const sq=el("span",{style:{display:"inline-block",width:10,height:10,borderRadius:3,background:bg,marginRight:4,border:bg==="#1e293b"?"1px solid #334155":"none"}});
    const s=el("span",null,sq,label);
    leg.appendChild(s);
  });
  wrap.appendChild(leg);
  return wrap;
}

function buildStats(){
  const {y,m}=state.cal;
  const pd=perfectInMonth(y,m);
  const isPM=pd>=25;
  const totalDays=new Date(y,m+1,0).getDate();
  const wrap=el("div",null);

  // Nav
  const nav=el("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12}});
  nav.appendChild(el("button",{className:"nav-btn",onClick:()=>{const d=new Date(y,m-1);setState({cal:{y:d.getFullYear(),m:d.getMonth()}})}},"â—€"));
  nav.appendChild(el("div",{style:{fontWeight:700}},monthName(y,m)));
  nav.appendChild(el("button",{className:"nav-btn",onClick:()=>{const d=new Date(y,m+1);setState({cal:{y:d.getFullYear(),m:d.getMonth()}})}},"â–¶"));
  wrap.appendChild(nav);

  // Summary cards
  const cards=el("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,marginBottom:12}});
  [
    {e:"â­",val:pd,label:"Perfect Days",color:"#22c55e"},
    {e:"ğŸ†",val:isPM?"YES!":pd+"/25",label:"Perfect Month",color:isPM?"#22c55e":"#f59e0b"},
    {e:"ğŸ“ˆ",val:Math.round((pd/totalDays)*100)+"%",label:"Completion",color:"#3b82f6"},
  ].forEach(c=>{
    cards.appendChild(el("div",{className:"stat-card"},
      el("div",{style:{fontSize:22}},c.e),
      el("div",{style:{fontSize:18,fontWeight:700,color:c.color}},String(c.val)),
      el("div",{style:{fontSize:10,color:"#64748b"}},c.label)
    ));
  });
  wrap.appendChild(cards);

  // Bar chart (canvas-based)
  const chartCard=el("div",{className:"card"});
  chartCard.appendChild(el("div",{style:{fontSize:13,fontWeight:600,color:"#94a3b8",marginBottom:10}},`Task Completion â€” ${monthName(y,m)}`));
  const canvas=el("canvas",{style:{width:"100%",maxHeight:"180px"}});
  canvas.width=440;canvas.height=180;
  chartCard.appendChild(canvas);
  wrap.appendChild(chartCard);

  // Draw chart after DOM insert
  setTimeout(()=>{
    const ctx=canvas.getContext("2d");
    const taskData=state.dailyTasks.map(t=>{
      let c=0;for(let d=1;d<=totalDays;d++)if(state.data[dKey(y,m,d)]?.daily?.[t.id])c++;
      return{label:t.icon+" "+t.label.split(" ").slice(0,2).join(" "),count:c};
    });
    const maxVal=Math.max(...taskData.map(d=>d.count),1);
    const W=canvas.width,H=canvas.height,pad=40,bottom=50;
    const bw=(W-pad*2)/taskData.length-8;
    ctx.clearRect(0,0,W,H);
    taskData.forEach((d,i)=>{
      const x=pad+i*((W-pad*2)/taskData.length)+4;
      const bh=((d.count/maxVal)*(H-bottom-10));
      const by=H-bottom-bh;
      ctx.fillStyle=COLORS[i%COLORS.length];
      ctx.beginPath();
      ctx.roundRect(x,by,bw,bh,4);
      ctx.fill();
      ctx.fillStyle="#64748b";
      ctx.font="9px sans-serif";
      ctx.save();ctx.translate(x+bw/2,H-bottom+6);ctx.rotate(-0.6);
      ctx.fillText(d.label,0,0);ctx.restore();
      ctx.fillStyle="#e2e8f0";
      ctx.font="bold 11px sans-serif";
      ctx.textAlign="center";
      ctx.fillText(d.count,x+bw/2,by-4);
    });
    // Y axis
    ctx.strokeStyle="#334155";ctx.lineWidth=1;
    ctx.beginPath();ctx.moveTo(pad,10);ctx.lineTo(pad,H-bottom);ctx.stroke();
    ctx.beginPath();ctx.moveTo(pad,H-bottom);ctx.lineTo(W-10,H-bottom);ctx.stroke();
  },50);

  // Weekly tasks
  const wCard=el("div",{className:"card"});
  wCard.appendChild(el("div",{style:{fontSize:13,fontWeight:600,color:"#94a3b8",marginBottom:10}},"Weekly Tasks"));
  const weeks=getWeeks(y,m);
  state.weeklyTasks.forEach(task=>{
    const done=weeks.filter(w=>w.some(d=>d&&state.data[dKey(y,m,d)]?.weekly?.[task.id])).length;
    const row=el("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8}});
    row.appendChild(el("span",null,task.icon));
    row.appendChild(el("span",{style:{flex:1,fontSize:13}},task.label));
    row.appendChild(el("span",{style:{color:"#22c55e",fontWeight:700,fontSize:13}},`${done}/${weeks.length} weeks`));
    wCard.appendChild(row);
  });
  wrap.appendChild(wCard);
  return wrap;
}

function buildModal(){
  const dk=state.selDay;
  if(!dk)return null;
  const selData=state.data[dk]||{daily:{},weekly:{}};
  const dateStr=new Date(dk+"T12:00:00").toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"});
  const perf=isPerfect(dk);

  const overlay=el("div",{className:"modal-overlay",onClick:()=>setState({selDay:null})});
  const box=el("div",{className:"modal-box",onClick:e=>e.stopPropagation()});

  const hdr=el("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}});
  const hdrL=el("div",null,el("div",{style:{fontWeight:700}},dateStr));
  if(perf)hdrL.appendChild(el("div",{style:{color:"#22c55e",fontSize:12,fontWeight:600}},"â­ Perfect Day!"));
  hdr.appendChild(hdrL);
  hdr.appendChild(el("button",{style:{background:"#334155",color:"#94a3b8",border:"none",borderRadius:8,padding:"4px 10px",fontSize:16,cursor:"pointer"},onClick:()=>setState({selDay:null})},"âœ•"));
  box.appendChild(hdr);

  state.dailyTasks.forEach(task=>{
    const done=!!selData.daily?.[task.id];
    const row=el("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",borderRadius:10,cursor:"pointer",
      border:`1px solid ${done?"#22c55e":"#334155"}`,background:done?"rgba(34,197,94,.1)":"#0f172a",marginBottom:6},
      onClick:()=>toggle(dk,"daily",task.id)});
    row.append(el("span",null,task.icon),
      el("span",{style:{flex:1,fontSize:13,color:done?"#64748b":"#e2e8f0",textDecoration:done?"line-through":"none"}},task.label),
      el("div",{style:{width:18,height:18,borderRadius:"50%",border:`2px solid ${done?"#22c55e":"#475569"}`,
        background:done?"#22c55e":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,fontSize:9,color:"#fff"}},done?"âœ“":"")
    );
    box.appendChild(row);
  });

  state.weeklyTasks.forEach(task=>{
    const done=!!selData.weekly?.[task.id];
    const row=el("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",borderRadius:10,cursor:"pointer",
      border:`1px solid ${done?"#3b82f6":"#334155"}`,background:done?"rgba(59,130,246,.1)":"#0f172a",marginBottom:6},
      onClick:()=>toggle(dk,"weekly",task.id)});
    row.append(el("span",null,task.icon),
      el("span",{style:{flex:1,fontSize:13,color:done?"#64748b":"#e2e8f0",textDecoration:done?"line-through":"none"}},task.label+" (weekly)"),
      el("div",{style:{width:18,height:18,borderRadius:"50%",border:`2px solid ${done?"#3b82f6":"#475569"}`,
        background:done?"#3b82f6":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,fontSize:9,color:"#fff"}},done?"âœ“":"")
    );
    box.appendChild(row);
  });

  overlay.appendChild(box);
  return overlay;
}

// â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render(){
  const root=document.getElementById("app");
  root.innerHTML="";
  root.appendChild(buildHeader());
  const rem=buildReminder();
  if(rem)root.appendChild(rem);
  const main=el("div",{style:{maxWidth:480,margin:"0 auto",padding:"16px 12px"}});
  if(state.view==="today")main.appendChild(buildToday());
  else if(state.view==="calendar")main.appendChild(buildCalendar());
  else main.appendChild(buildStats());
  root.appendChild(main);
  const modal=buildModal();
  if(modal)root.appendChild(modal);
}

load();
render();
</script>
</body>
</html>
